<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - BigKey Tour</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-header.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Header size adjustments for this page */
        .management-header-content {
            max-width: 100% !important;
            height: 56px !important;
            padding: 0 10px !important;
        }
        .management-logo {
            font-size: 16px !important;
            gap: 6px !important;
        }
        .management-logo i {
            font-size: 18px !important;
        }
        .management-badge {
            font-size: 9px !important;
            padding: 2px 5px !important;
        }
        .management-nav-menu {
            gap: 16px !important;
        }
        .management-nav-menu a {
            padding: 6px 10px !important;
            font-size: 13px !important;
        }
        .management-auth-section {
            gap: 10px !important;
        }
        .management-user-avatar {
            width: 28px !important;
            height: 28px !important;
            font-size: 13px !important;
        }
        .management-user-name {
            font-size: 12px !important;
        }
        .management-user-role {
            font-size: 10px !important;
        }
        .management-logout-btn {
            padding: 6px 10px !important;
            font-size: 12px !important;
        }
        
        .admin-notification {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s;
        }
        
        .admin-notification:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #DC2626;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .admin-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #059669;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .admin-logout-btn {
            background: #DC2626;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-logout-btn:hover {
            background: #B91C1C;
            transform: translateY(-1px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .admin-header-content {
                flex-direction: column;
                height: auto;
                padding: 15px 20px;
                gap: 15px;
            }
            
            .admin-nav-menu {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .admin-auth-section {
                flex-wrap: wrap;
                gap: 15px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Unified Management Header -->
    <header class="management-header">
        <div class="management-header-content">
            <!-- Logo Section -->
            <div class="management-logo">
                <i class="fas fa-key"></i>
                <span>BigKey Tour</span>
                <span class="management-badge" id="role-badge">ADMIN</span>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="management-nav-menu">
                <a href="13-admin-dashboard.html" class="active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="11-partner-management.html">
                    <i class="fas fa-handshake"></i>
                    Đối tác
                </a>
                <a href="20-admin-tour-approval.html">
                    <i class="fas fa-check-circle"></i>
                    Duyệt tour
                </a>
                <a href="21-admin-flash-sale.html">
                    <i class="fas fa-bolt"></i>
                    Flash Sale
                </a>
                <a href="25-admin-tour-management.html">
                    <i class="fas fa-map-marked-alt"></i>
                    Quản lý tour
                </a>
                <a href="26-admin-order-management.html">
                    <i class="fas fa-shopping-cart"></i>
                    Đơn hàng
                </a>
                <a href="partner-settings.html">
                    <i class="fas fa-cog"></i>
                    Cài đặt
                </a>
            </nav>
            
            <!-- Auth Section -->
            <div class="management-auth-section">
                <!-- Notifications -->
                <div class="management-notification">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
                
                <!-- User Info -->
                <div class="management-user-info">
                    <div class="management-user-avatar">A</div>
                    <div class="management-user-details">
                        <div class="management-user-name">Admin User</div>
                        <div class="management-user-role">Administrator</div>
                    </div>
                </div>
                
                <!-- Logout Button -->
                <button class="management-logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Đăng xuất
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard -->
        <div class="dashboard">
            <!-- Sidebar -->
            <div class="sidebar fade-in">
                <!-- Admin Profile -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 80px; height: 80px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; color: white; font-size: 24px; overflow: hidden; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop" alt="Admin Avatar" style="width: 100%; height: 100%; object-fit: cover; border-radius: 15px;">
                    </div>
                    <h3 style="margin: 0 0 5px 0; color: #333;">Super Admin</h3>
                    <p style="color: #666; font-size: 14px; margin: 0;">Quyền toàn hệ thống</p>
                    <div style="margin-top: 10px;">
                        <span style="background: #e74c3c; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px;">
                            🛡️ Administrator
                        </span>
                    </div>
                </div>

                <!-- System Health -->
                <div style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px; color: #333;">
                        <i class="fas fa-server"></i> Tình trạng hệ thống
                    </h4>
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px;">
                            <span style="font-size: 14px; color: #155724;">API Server</span>
                            <span style="color: #27ae60;">🟢 Online</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px;">
                            <span style="font-size: 14px; color: #155724;">Database</span>
                            <span style="color: #27ae60;">🟢 Healthy</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                            <span style="font-size: 14px; color: #856404;">Payment Gateway</span>
                            <span style="color: #f39c12;">🟡 Warning</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px;">
                            <span style="font-size: 14px; color: #155724;">Email Service</span>
                            <span style="color: #27ae60;">🟢 Active</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Admin Actions -->
                <div style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px; color: #333;">
                        <i class="fas fa-bolt"></i> Thao tác Admin
                    </h4>
                    <div style="display: grid; gap: 10px;">
                        <button class="btn btn-primary" style="width: 100%; justify-content: flex-start;" onclick="manageUsers()">
                            <i class="fas fa-users-cog"></i> Quản lý Users
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;" onclick="managePartners()">
                            <i class="fas fa-handshake"></i> Quản lý Partners
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;" onclick="systemSettings()">
                            <i class="fas fa-cogs"></i> Cài đặt hệ thống
                        </button>
                    </div>
                </div>

                <!-- Recent Admin Activities -->
                <div>
                    <h4 style="margin-bottom: 15px; color: #333;">
                        <i class="fas fa-history"></i> Hoạt động gần đây
                    </h4>
                    <div style="display: grid; gap: 10px;">
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                            <div style="font-weight: bold; color: #333;">Thêm đối tác mới</div>
                            <div style="color: #666;">TravelPro Company</div>
                            <div style="color: #999; font-size: 12px;">30 phút trước</div>
                        </div>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                            <div style="font-weight: bold; color: #333;">Cập nhật hệ thống</div>
                            <div style="color: #666;">Version 2.4.1</div>
                            <div style="color: #999; font-size: 12px;">2 giờ trước</div>
                        </div>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                            <div style="font-weight: bold; color: #333;">Xử lý khiếu nại</div>
                            <div style="color: #666;">Đơn #BK2025080023</div>
                            <div style="color: #999; font-size: 12px;">4 giờ trước</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content fade-in">
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <div>
                        <h1 style="color: #333; margin: 0;">
                            <i class="fas fa-tachometer-alt"></i> Admin Dashboard
                        </h1>
                        <p style="color: #666; margin: 5px 0 0 0;">Tổng quan và quản lý toàn hệ thống BigKey Travel</p>
                    </div>
                </div>

                <!-- System Overview Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="stat-value">12.5B</div>
                        <div class="stat-label">Tổng doanh thu (VNĐ)</div>
                        <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">📈 +18% vs năm trước</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                        <div class="stat-value">156</div>
                        <div class="stat-label">Đối tác hoạt động</div>
                        <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">📈 +12 đối tác mới</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        <div class="stat-value">24,567</div>
                        <div class="stat-label">Người dùng</div>
                        <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">📈 +8% vs tháng trước</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <div class="stat-value">99.7%</div>
                        <div class="stat-label">Uptime hệ thống</div>
                        <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">🔄 8.9ms response time</div>
                    </div>
                </div>

                </div>
                <!-- Users & Partners Management -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- User Management -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #333; font-size: 16px;">
                                <i class="fas fa-users"></i> Quản lý người dùng
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="addNewUser()" style="font-size: 12px; padding: 5px 10px;">
                                <i class="fas fa-user-plus"></i> Thêm user
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Users hoạt động:</span>
                                <span style="font-weight: bold; color: #27ae60;">18,234</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Users mới hôm nay:</span>
                                <span style="font-weight: bold; color: #667eea;">67</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Users bị khóa:</span>
                                <span style="font-weight: bold; color: #e74c3c;">23</span>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <h5 style="margin: 0 0 8px 0; color: #333; font-size: 14px;">🔍 Tìm kiếm nhanh</h5>
                            <input type="text" placeholder="Email hoặc ID người dùng..." style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 8px; font-size: 14px; box-sizing: border-box;">
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-sm btn-primary" style="font-size: 12px;">Tìm</button>
                                <button class="btn btn-sm btn-secondary" onclick="viewAllUsers()" style="font-size: 12px;">Xem tất cả</button>
                            </div>
                        </div>
                    </div>

                    <!-- Partner Management -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #333; font-size: 16px;">
                                <i class="fas fa-handshake"></i> Quản lý đối tác
                            </h3>
                            <button class="btn btn-primary btn-sm" onclick="addNewPartner()" style="font-size: 12px; padding: 5px 10px;">
                                <i class="fas fa-plus"></i> Thêm đối tác
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Đối tác hoạt động:</span>
                                <span style="font-weight: bold; color: #27ae60;">156</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Chờ phê duyệt:</span>
                                <span style="font-weight: bold; color: #f39c12;">8</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Tạm ngưng:</span>
                                <span style="font-weight: bold; color: #e74c3c;">3</span>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <h5 style="margin: 0 0 8px 0; color: #333; font-size: 14px;">📝 Phê duyệt nhanh</h5>
                            <div style="display: grid; gap: 5px;">
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #666;">
                                    <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=30&h=30&fit=crop" alt="TravelPro Logo" style="width: 20px; height: 20px; border-radius: 4px; object-fit: cover;">
                                    TravelPro Company (Chờ duyệt)
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm" style="background: #27ae60; color: white; font-size: 12px;" onclick="approvePartner('TravelPro')">Duyệt</button>
                                    <button class="btn btn-sm" style="background: #e74c3c; color: white; font-size: 12px;" onclick="rejectPartner('TravelPro')">Từ chối</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                <!-- System Operations & Financial Overview -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- System Operations -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08);">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 16px;">
                            <i class="fas fa-cogs"></i> Vận hành hệ thống
                        </h3>
                        
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                                <div>
                                    <div style="font-weight: bold; color: #333; font-size: 14px;">Backup Database</div>
                                    <div style="color: #666; font-size: 12px;">Lần cuối: 03:00 hôm nay</div>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="backupNow()" style="font-size: 12px;">Backup ngay</button>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                                <div>
                                    <div style="font-weight: bold; color: #333; font-size: 14px;">Maintenance Mode</div>
                                    <div style="color: #666; font-size: 12px;">Hệ thống đang hoạt động</div>
                                </div>
                                <button class="btn btn-sm" style="background: #f39c12; color: white; font-size: 12px;" onclick="maintenanceMode()">Bảo trì</button>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                                <div>
                                    <div style="font-weight: bold; color: #333; font-size: 14px;">Cache Clear</div>
                                    <div style="color: #666; font-size: 12px;">Tăng hiệu suất hệ thống</div>
                                </div>
                                <button class="btn btn-sm btn-secondary" onclick="clearCache()" style="font-size: 12px;">Clear cache</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time System Performance & Traffic Analysis -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 25px;">

                    <!-- Revenue Trends -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08);">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 16px;">
                            <i class="fas fa-money-bill-trend-up"></i> Xu hướng doanh thu
                        </h3>
                        
                        <!-- Revenue Stats -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 16px; font-weight: bold; color: #27ae60;">📈 +15.3%</div>
                                <div style="font-size: 11px; color: #666;">vs tháng trước</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center;">
                                <div style="font-size: 16px; font-weight: bold; color: #667eea;">8.2B VNĐ</div>
                                <div style="font-size: 11px; color: #666;">Tháng này</div>
                            </div>
                        </div>
                        
                        <div style="height: 180px;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- User Activity & Geographic Distribution -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 25px;">

                    <!-- Geographic Distribution -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 15px rgba(0,0,0,0.08);">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 16px;">
                            <i class="fas fa-globe-asia"></i> Phân bổ địa lý
                        </h3>
                        
                        <div style="display: grid; gap: 12px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px;">🇻🇳</span>
                                    <span style="color: #666; font-size: 14px;">Việt Nam</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 80px; height: 5px; background: #f8f9fa; border-radius: 3px; overflow: hidden;">
                                        <div style="width: 85%; height: 100%; background: #27ae60;"></div>
                                    </div>
                                    <span style="font-weight: bold; color: #27ae60; font-size: 14px;">85%</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px;">🇰🇷</span>
                                    <span style="color: #666; font-size: 14px;">Hàn Quốc</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 80px; height: 5px; background: #f8f9fa; border-radius: 3px; overflow: hidden;">
                                        <div style="width: 8%; height: 100%; background: #667eea;"></div>
                                    </div>
                                    <span style="font-weight: bold; color: #667eea; font-size: 14px;">8%</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px;">🇯🇵</span>
                                    <span style="color: #666; font-size: 14px;">Nhật Bản</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 80px; height: 5px; background: #f8f9fa; border-radius: 3px; overflow: hidden;">
                                        <div style="width: 4%; height: 100%; background: #f39c12;"></div>
                                    </div>
                                    <span style="font-weight: bold; color: #f39c12; font-size: 14px;">4%</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px;">🌏</span>
                                    <span style="color: #666; font-size: 14px;">Khác</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 80px; height: 5px; background: #f8f9fa; border-radius: 3px; overflow: hidden;">
                                        <div style="width: 3%; height: 100%; background: #e74c3c;"></div>
                                    </div>
                                    <span style="font-weight: bold; color: #e74c3c; font-size: 14px;">3%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="height: 140px;">
                            <canvas id="geoChart2"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Initialize Charts
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdminCharts();
        });

        let platformChart, serverChart;
        let currentPlatformPeriod = '24h';

        const platformData = {
            '24h': {
                labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                users: [1200, 950, 800, 650, 1100, 1800, 2800, 3200, 3500, 3100, 2600, 1800],
                requests: [15000, 12000, 8000, 6500, 18000, 28000, 35000, 42000, 45000, 40000, 35000, 25000],
                errors: [45, 32, 28, 22, 55, 88, 120, 135, 142, 128, 105, 78]
            },
            '7d': {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                users: [18500, 22300, 25100, 28900, 31200, 19800, 16500],
                requests: [285000, 342000, 398000, 445000, 485000, 312000, 265000],
                errors: [1250, 1580, 1720, 1950, 2100, 1420, 1180]
            },
            '30d': {
                labels: ['W1', 'W2', 'W3', 'W4'],
                users: [85000, 92000, 88000, 95000],
                requests: [1250000, 1380000, 1320000, 1420000],
                errors: [5200, 5800, 5500, 5900]
            }
        };

        function initializeAdminCharts() {
            // Platform Analytics Chart
            const platformCtx = document.getElementById('platformChart').getContext('2d');
            platformChart = new Chart(platformCtx, {
                type: 'line',
                data: {
                    labels: platformData['24h'].labels,
                    datasets: [{
                        label: 'Active Users',
                        data: platformData['24h'].users,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }, {
                        label: 'API Requests',
                        data: platformData['24h'].requests,
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        yAxisID: 'y1'
                    }, {
                        label: 'Errors',
                        data: platformData['24h'].errors,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: false,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        yAxisID: 'y2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#667eea',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 1) {
                                        label += context.parsed.y.toLocaleString();
                                    } else {
                                        label += context.parsed.y.toLocaleString();
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#666'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#666',
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                color: '#666',
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: false,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Server Performance Chart
            const serverCtx = document.getElementById('serverChart').getContext('2d');
            serverChart = new Chart(serverCtx, {
                type: 'line',
                data: {
                    labels: ['10:30', '10:35', '10:40', '10:45', '10:50', '10:55', '11:00'],
                    datasets: [{
                        label: 'CPU %',
                        data: [78, 82, 85, 87, 85, 83, 80],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Memory %',
                        data: [58, 60, 62, 64, 62, 60, 58],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Response Time (ms)',
                        data: [45, 52, 58, 62, 55, 48, 42],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return value + 'ms';
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Financial Chart
            const financialCtx = document.getElementById('financialChart').getContext('2d');
            new Chart(financialCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Doanh thu Tours', 'Phí dịch vụ', 'Hoa hồng đối tác', 'Chi phí vận hành'],
                    datasets: [{
                        data: [8500, 1200, 2800, 500],
                        backgroundColor: [
                            '#667eea',
                            '#27ae60',
                            '#f39c12',
                            '#e74c3c'
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#667eea',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value.toLocaleString()} triệu VNĐ (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });

            // Traffic Sources Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            new Chart(trafficCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Direct', 'Social Media', 'Search Engine', 'Email', 'Referral'],
                    datasets: [{
                        data: [35, 25, 20, 12, 8],
                        backgroundColor: [
                            '#667eea',
                            '#27ae60',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6'
                        ],
                        borderWidth: 0,
                        hoverOffset: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Doanh thu (tỷ VNĐ)',
                        data: [6.8, 7.2, 6.9, 8.1, 7.8, 8.5, 8.2],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + 'B';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: ['06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                    datasets: [{
                        label: 'Đăng ký',
                        data: [12, 25, 45, 62, 38, 28],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Đặt tour',
                        data: [45, 78, 125, 156, 98, 72],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Thanh toán',
                        data: [32, 58, 98, 124, 78, 56],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Geographic Chart
            const geoCtx = document.getElementById('geoChart').getContext('2d');
            new Chart(geoCtx, {
                type: 'polarArea',
                data: {
                    labels: ['Việt Nam', 'Hàn Quốc', 'Nhật Bản', 'Khác'],
                    datasets: [{
                        data: [85, 8, 4, 3],
                        backgroundColor: [
                            'rgba(39, 174, 96, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(231, 76, 60, 0.8)'
                        ],
                        borderColor: [
                            '#27ae60',
                            '#667eea',
                            '#f39c12',
                            '#e74c3c'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Update platform stats
            updatePlatformStats();
        }

        function switchPlatformChart(period) {
            currentPlatformPeriod = period;
            
            // Update button states
            document.querySelectorAll('#btn-24h, #btn-7d, #btn-30d').forEach(btn => {
                btn.style.background = '#6c757d';
                btn.style.color = 'white';
            });
            document.getElementById(`btn-${period}`).style.background = '#667eea';
            document.getElementById(`btn-${period}`).style.color = 'white';
            
            // Update chart data
            const data = platformData[period];
            platformChart.data.labels = data.labels;
            platformChart.data.datasets[0].data = data.users;
            platformChart.data.datasets[1].data = data.requests;
            platformChart.data.datasets[2].data = data.errors;
            
            platformChart.update('active');
            updatePlatformStats();
        }

        function updatePlatformStats() {
            const data = platformData[currentPlatformPeriod];
            
            // Calculate totals
            const totalUsers = Math.max(...data.users);
            const totalRequests = Math.max(...data.requests);
            const totalErrors = data.errors.reduce((a, b) => a + b, 0);
            const totalRequests_sum = data.requests.reduce((a, b) => a + b, 0);
            const errorRate = ((totalErrors / totalRequests_sum) * 100).toFixed(1);
            
            document.getElementById('activeUsers').textContent = totalUsers.toLocaleString();
            document.getElementById('apiRequests').textContent = totalRequests.toLocaleString();
            document.getElementById('errorRate').textContent = errorRate + '%';
            
            // Update error rate color
            const errorElement = document.getElementById('errorRate');
            if (errorRate > 1) {
                errorElement.style.color = '#e74c3c';
            } else if (errorRate > 0.5) {
                errorElement.style.color = '#f39c12';
            } else {
                errorElement.style.color = '#27ae60';
            }
        }

        // Core Admin Functions
        function showNotifications() {
            // Implement notification system
            console.log('Loading notifications...');
        }

        function investigatePayment() {
            // Implement payment investigation
            console.log('Investigating payment gateway...');
        }

        function scaleServers() {
            // Implement server scaling
            console.log('Scaling servers...');
        }

        function optimizeDB() {
            // Implement database optimization
            console.log('Optimizing database...');
        }

        function manageUsers() {
            // Navigate to user management
            console.log('Loading user management...');
        }

        function managePartners() {
            // Navigate to partner management
            console.log('Loading partner management...');
        }

        function systemSettings() {
            // Navigate to system settings
            console.log('Loading system settings...');
        }

        function addNewUser() {
            // Add new user form
            console.log('Opening new user form...');
        }

        function viewAllUsers() {
            // View all users list
            console.log('Loading all users...');
        }

        function addNewPartner() {
            // Add new partner form
            console.log('Opening new partner form...');
        }

        function approvePartner(name) {
            // Approve partner
            console.log(`Approving partner: ${name}`);
        }

        function rejectPartner(name) {
            // Reject partner
            console.log(`Rejecting partner: ${name}`);
        }

        function backupNow() {
            // Backup database
            console.log('Starting database backup...');
        }

        function maintenanceMode() {
            // Enable maintenance mode
            console.log('Enabling maintenance mode...');
        }

        function clearCache() {
            // Clear system cache
            console.log('Clearing cache...');
        }

        function viewFullLogs() {
            // View system logs
            console.log('Loading system logs...');
        }

        function exportLogs() {
            // Export logs
            console.log('Exporting logs...');
        }

        function logout() {
            // Logout functionality
            console.log('Logging out...');
        }

        // Header Management Functions
        function setActiveNavigation() {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.management-nav-menu a');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        }

        function setUserRole(role, userName) {
            const roleBadge = document.getElementById('role-badge');
            const userRole = document.getElementById('user-role');
            const userNameElement = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            
            // Set role badge
            roleBadge.textContent = role.toUpperCase();
            
            // Set user role text
            const roleTexts = {
                'admin': 'Administrator',
                'partner': 'Đối tác',
                'manager': 'Quản lý'
            };
            userRole.textContent = roleTexts[role] || role;
            
            // Set user name
            if (userName) {
                userNameElement.textContent = userName;
                userAvatar.textContent = userName.charAt(0).toUpperCase();
            }
        }

        // Initialize header when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setActiveNavigation();
            setUserRole('admin', 'Super Admin');
        });
    </script>
</body>
</html>

